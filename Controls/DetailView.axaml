<UserControl x:Class="Weather.Dashboard.Avalonia.Controls.DetailView" xmlns="https://github.com/avaloniaui" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:vm="using:Weather.Dashboard.Avalonia.ViewModels" xmlns:controls="using:Weather.Dashboard.Avalonia.Controls" xmlns:conv="using:Weather.Dashboard.Avalonia.Converters" xmlns:models="clr-namespace:Weather.Dashboard.Avalonia.Models" x:DataType="vm:CityWeatherViewModel" Background="{DynamicResource BackgroundBrush}">
    <Grid RowDefinitions="*" Background="{DynamicResource BackgroundBrush}">
        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
            <StackPanel Spacing="20" Margin="24,20">
                <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="20" Padding="24" BorderBrush="{DynamicResource OutlineBrush}" BorderThickness="1">
                    <Grid ColumnDefinitions="Auto,*,Auto">
                        <Button Grid.Column="0" Background="{DynamicResource SurfaceVariantBrush}" BorderThickness="0" CornerRadius="12" Width="48" Height="48" Cursor="Hand" Click="BackButton_Click">
                            <PathIcon Data="{StaticResource IconArrowBack}" Foreground="{DynamicResource OnSurfaceBrush}" Width="24" Height="24"/>
                        </Button>
                        <StackPanel Grid.Column="1" HorizontalAlignment="Center" VerticalAlignment="Center">
                            <TextBlock Text="{Binding City.Name}" FontSize="28" FontWeight="Bold" Foreground="{DynamicResource OnSurfaceBrush}" HorizontalAlignment="Center"/>
                            <Border Background="{DynamicResource SurfaceVariantBrush}" CornerRadius="10" Padding="12,6" HorizontalAlignment="Center" Margin="0,8,0,0">
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <PathIcon Data="{StaticResource IconLocation}" Foreground="{DynamicResource OnSurfaceVariantBrush}" Width="14" Height="14" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding City.Country}" FontSize="13" Foreground="{DynamicResource OnSurfaceVariantBrush}"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </Grid>
                </Border>
                <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" ColumnSpacing="20" RowSpacing="20">
                    <Border Grid.Column="0" Grid.Row="0" IsVisible="{Binding $parent[Window].((vm:MainViewModel)DataContext).ShowCurrentWeatherCard}" Background="{DynamicResource SurfaceBrush}" CornerRadius="20" Padding="24" BorderBrush="{DynamicResource OutlineBrush}" BorderThickness="1">
                        <StackPanel Spacing="16" VerticalAlignment="Center">
                            <Viewbox Width="80" Height="80" HorizontalAlignment="Center">
                                <PathIcon Data="{Binding CurrentWeather.Condition, Converter={StaticResource ConditionToIcon}}" Foreground="{DynamicResource PrimaryBrush}"/>
                            </Viewbox>
                            <TextBlock Text="{Binding CurrentWeather.Temperature, Converter={StaticResource TempToString}}" FontSize="56" FontWeight="Bold" Foreground="{DynamicResource OnSurfaceBrush}" HorizontalAlignment="Center"/>
                            <TextBlock Text="{Binding CurrentWeather.Description}" FontSize="16" Foreground="{DynamicResource OnSurfaceBrush}" HorizontalAlignment="Center" FontWeight="Medium"/>
                            <Border Background="{DynamicResource SurfaceVariantBrush}" CornerRadius="10" Padding="12,8" HorizontalAlignment="Center">
                                <TextBlock Text="{Binding CurrentWeather.FeelsLike, StringFormat=&apos;Feels like {0:F0}Â°&apos;}" FontSize="14" Foreground="{DynamicResource OnSurfaceVariantBrush}" FontWeight="SemiBold"/>
                            </Border>
                            <UniformGrid Columns="2" Rows="2" Margin="8,12,8,0">
                                <Border Background="{DynamicResource SurfaceVariantBrush}" CornerRadius="12" Padding="12,8" Margin="4">
                                    <StackPanel HorizontalAlignment="Center">
                                        <PathIcon Data="{StaticResource IconHumidity}" Foreground="{DynamicResource SecondaryBrush}" Width="18" Height="18"/>
                                        <TextBlock Text="{Binding CurrentWeather.Humidity, StringFormat=&apos;{}{0}%&apos;}" FontSize="16" FontWeight="Bold" Foreground="{DynamicResource OnSurfaceBrush}" HorizontalAlignment="Center" Margin="0,6,0,0"/>
                                        <TextBlock Text="Humidity" FontSize="11" Foreground="{DynamicResource OnSurfaceVariantBrush}" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </Border>
                                <Border Background="{DynamicResource SurfaceVariantBrush}" CornerRadius="12" Padding="12,8" Margin="4">
                                    <StackPanel HorizontalAlignment="Center">
                                        <PathIcon Data="{StaticResource IconWind}" Foreground="{DynamicResource PrimaryBrush}" Width="18" Height="18"/>
                                        <TextBlock Text="{Binding CurrentWeather.WindSpeed, StringFormat=&apos;{}{0:F1}&apos;}" FontSize="16" FontWeight="Bold" Foreground="{DynamicResource OnSurfaceBrush}" HorizontalAlignment="Center" Margin="0,6,0,0"/>
                                        <TextBlock Text="m/s" FontSize="11" Foreground="{DynamicResource OnSurfaceVariantBrush}" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </Border>
                                <Border Background="{DynamicResource SurfaceVariantBrush}" CornerRadius="12" Padding="12,8" Margin="4">
                                    <StackPanel HorizontalAlignment="Center">
                                        <PathIcon Data="{StaticResource IconPressure}" Foreground="{DynamicResource InfoBrush}" Width="18" Height="18"/>
                                        <TextBlock Text="{Binding CurrentWeather.Pressure}" FontSize="16" FontWeight="Bold" Foreground="{DynamicResource OnSurfaceBrush}" HorizontalAlignment="Center" Margin="0,6,0,0"/>
                                        <TextBlock Text="hPa" FontSize="11" Foreground="{DynamicResource OnSurfaceVariantBrush}" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </Border>
                                <Border Background="{DynamicResource SurfaceVariantBrush}" CornerRadius="12" Padding="12,8" Margin="4">
                                    <StackPanel HorizontalAlignment="Center">
                                        <PathIcon Data="{StaticResource IconVisibility}" Foreground="{DynamicResource WarningBrush}" Width="18" Height="18"/>
                                        <TextBlock Text="{Binding CurrentWeather.Visibility, StringFormat=&apos;{}{0:F1}&apos;}" FontSize="16" FontWeight="Bold" Foreground="{DynamicResource OnSurfaceBrush}" HorizontalAlignment="Center" Margin="0,6,0,0"/>
                                        <TextBlock Text="km" FontSize="11" Foreground="{DynamicResource OnSurfaceVariantBrush}" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </Border>
                            </UniformGrid>
                        </StackPanel>
                    </Border>
                    <Border Grid.Column="1" Grid.Row="0" IsVisible="{Binding $parent[Window].((vm:MainViewModel)DataContext).ShowForecastCard}" Background="{DynamicResource SurfaceBrush}" CornerRadius="20" Padding="24" BorderBrush="{DynamicResource OutlineBrush}" BorderThickness="1">
                        <StackPanel Spacing="14">
                            <StackPanel Orientation="Horizontal" Spacing="12">
                                <Border Background="{DynamicResource SurfaceVariantBrush}" CornerRadius="10" Padding="8" Width="40" Height="40">
                                    <PathIcon Data="{StaticResource IconCalendar}" Foreground="{DynamicResource PrimaryBrush}" Width="20" Height="20" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                </Border>
                                <StackPanel VerticalAlignment="Center">
                                    <TextBlock Text="6-Day Forecast" FontSize="18" FontWeight="Bold" Foreground="{DynamicResource OnSurfaceBrush}"/>
                                    <TextBlock Text="Starting from tomorrow" FontSize="12" Foreground="{DynamicResource OnSurfaceVariantBrush}" Margin="0,2,0,0"/>
                                </StackPanel>
                            </StackPanel>
                            <ScrollViewer VerticalScrollBarVisibility="Auto" Margin="0,-15">
                                <ItemsControl ItemsSource="{Binding Forecast}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate DataType="models:ForecastItem">
                                            <Border Background="{DynamicResource SurfaceVariantBrush}" CornerRadius="12" Padding="12,10" Margin="0,4">
                                                <Grid ColumnDefinitions="80,Auto,*,Auto">
                                                    <TextBlock Grid.Column="0" Text="{Binding DateTime, StringFormat=&apos;{}{0:ddd}&apos;}" FontSize="14" FontWeight="SemiBold" Foreground="{DynamicResource OnSurfaceBrush}" VerticalAlignment="Center"/>
                                                    <Border Grid.Column="1" Background="{DynamicResource SurfaceBrush}" CornerRadius="8" Padding="8" Margin="8,0">
                                                        <Viewbox Width="22" Height="22">
                                                            <PathIcon Data="{Binding Condition, Converter={StaticResource ConditionToIcon}}" Foreground="{DynamicResource PrimaryBrush}"/>
                                                        </Viewbox>
                                                    </Border>
                                                    <TextBlock Grid.Column="2" Text="{Binding Condition}" FontSize="13" Foreground="{DynamicResource OnSurfaceBrush}" VerticalAlignment="Center" Margin="8,0"/>
                                                    <StackPanel Grid.Column="3" Orientation="Horizontal" Spacing="6">
                                                        <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="8" Padding="10,6" Width="70">
                                                            <TextBlock Text="{Binding MaxTemp, Converter={StaticResource TempToString}}" FontSize="13" FontWeight="Bold" Foreground="{DynamicResource OnSurfaceBrush}" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                                        </Border>
                                                        <Border Background="{DynamicResource PrimaryContainerBrush}" CornerRadius="8" Padding="10,6" Width="70">
                                                            <TextBlock Text="{Binding MinTemp, Converter={StaticResource TempToString}}" FontSize="13" Foreground="{DynamicResource OnPrimaryContainerBrush}" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                                        </Border>
                                                    </StackPanel>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </StackPanel>
                    </Border>
                    <Border Grid.Column="0" Grid.Row="1" IsVisible="{Binding $parent[Window].((vm:MainViewModel)DataContext).ShowSunTimesCard}" Background="{DynamicResource SurfaceBrush}" CornerRadius="20" Padding="24" BorderBrush="{DynamicResource OutlineBrush}" BorderThickness="1">
                        <StackPanel Spacing="16">
                            <StackPanel Orientation="Horizontal" Spacing="12">
                                <Border Background="{DynamicResource SurfaceVariantBrush}" CornerRadius="10" Padding="8" Width="40" Height="40">
                                    <PathIcon Data="{StaticResource IconSunny}" Foreground="{DynamicResource WarningBrush}" Width="20" Height="20" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                </Border>
                                <StackPanel VerticalAlignment="Center">
                                    <TextBlock Text="Sun Times" FontSize="18" FontWeight="Bold" Foreground="{DynamicResource OnSurfaceBrush}"/>
                                    <TextBlock Text="Daily cycle" FontSize="12" Foreground="{DynamicResource OnSurfaceVariantBrush}" Margin="0,2,0,0"/>
                                </StackPanel>
                            </StackPanel>
                            <Border Background="{DynamicResource SurfaceVariantBrush}" CornerRadius="14" Padding="16,12">
                                <StackPanel Orientation="Horizontal" Spacing="12">
                                    <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="10" Padding="10" Width="38" Height="38">
                                        <PathIcon Data="{StaticResource IconSunrise}" Foreground="{DynamicResource PrimaryBrush}" Width="20" Height="20" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                    </Border>
                                    <StackPanel VerticalAlignment="Center">
                                        <TextBlock Text="Sunrise" FontSize="12" Foreground="{DynamicResource OnSurfaceVariantBrush}" FontWeight="Medium"/>
                                        <TextBlock Text="{Binding CurrentWeather.Sunrise, StringFormat=&apos;{}{0:HH:mm}&apos;}" FontSize="20" FontWeight="Bold" Foreground="{DynamicResource OnSurfaceBrush}" Margin="0,4,0,0"/>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                            <Border Background="{DynamicResource SurfaceVariantBrush}" CornerRadius="14" Padding="16,12">
                                <StackPanel Orientation="Horizontal" Spacing="12">
                                    <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="10" Padding="10" Width="38" Height="38">
                                        <PathIcon Data="{StaticResource IconSunset}" Foreground="{DynamicResource SecondaryBrush}" Width="20" Height="20" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                    </Border>
                                    <StackPanel VerticalAlignment="Center">
                                        <TextBlock Text="Sunset" FontSize="12" Foreground="{DynamicResource OnSurfaceVariantBrush}" FontWeight="Medium"/>
                                        <TextBlock Text="{Binding CurrentWeather.Sunset, StringFormat=&apos;{}{0:HH:mm}&apos;}" FontSize="20" FontWeight="Bold" Foreground="{DynamicResource OnSurfaceBrush}" Margin="0,4,0,0"/>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </Border>
                    <Border Grid.Column="1" Grid.Row="1" IsVisible="{Binding $parent[Window].((vm:MainViewModel)DataContext).ShowHourlyChart}" Background="{DynamicResource SurfaceBrush}" CornerRadius="20" Padding="24" BorderBrush="{DynamicResource OutlineBrush}" BorderThickness="1">
                        <StackPanel Spacing="14">
                            <StackPanel Orientation="Horizontal" Spacing="12">
                                <Border Background="{DynamicResource SurfaceVariantBrush}" CornerRadius="10" Padding="8" Width="40" Height="40">
                                    <PathIcon Data="{StaticResource IconChart}" Foreground="{DynamicResource InfoBrush}" Width="20" Height="20" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                </Border>
                                <StackPanel VerticalAlignment="Center">
                                    <TextBlock Text="24-Hour Forecast" FontSize="18" FontWeight="Bold" Foreground="{DynamicResource OnSurfaceBrush}"/>
                                    <TextBlock Text="Temperature trend" FontSize="12" Foreground="{DynamicResource OnSurfaceVariantBrush}" Margin="0,2,0,0"/>
                                </StackPanel>
                            </StackPanel>
                            <Border Background="{DynamicResource SurfaceVariantBrush}" CornerRadius="16" Padding="12" Height="240">
                                <Grid>
                                    <controls:SimpleLineChart DataPoints="{Binding HourlyTemperatures}" Foreground="{DynamicResource PrimaryBrush}" IsVisible="{Binding HourlyTemperatures, Converter={x:Static ObjectConverters.IsNotNull}}"/>
                                    <Border Background="Transparent" IsVisible="{Binding HourlyTemperatures, Converter={x:Static ObjectConverters.IsNull}}">
                                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="12">
                                            <ProgressBar IsIndeterminate="True" Width="100" Height="3" Foreground="{DynamicResource PrimaryBrush}" BorderThickness="0" Background="Transparent"/>
                                            <TextBlock Text="Loading chart..." Foreground="{DynamicResource OnSurfaceVariantBrush}" FontSize="12" HorizontalAlignment="Center"/>
                                        </StackPanel>
                                    </Border>
                                    <Border Background="Transparent" IsVisible="{Binding ErrorMessage, Converter={x:Static ObjectConverters.IsNotNull}}">
                                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="12">
                                            <PathIcon Data="{StaticResource IconError}" Foreground="{DynamicResource ErrorBrush}" Width="28" Height="28" HorizontalAlignment="Center"/>
                                            <TextBlock Text="Failed to load chart" Foreground="{DynamicResource ErrorBrush}" FontSize="12" FontWeight="Bold" HorizontalAlignment="Center"/>
                                        </StackPanel>
                                    </Border>
                                </Grid>
                            </Border>
                            <UniformGrid Columns="3" Rows="1">
                                <Border Background="{DynamicResource SurfaceVariantBrush}" CornerRadius="10" Padding="10,8" Margin="0,0,4,0">
                                    <StackPanel HorizontalAlignment="Center">
                                        <TextBlock Text="Min" FontSize="10" Foreground="{DynamicResource OnSurfaceVariantBrush}" HorizontalAlignment="Center"/>
                                        <TextBlock Text="{Binding HourlyTemperatures, Converter={StaticResource MinTempConverter}}" FontSize="16" FontWeight="Bold" Foreground="{DynamicResource OnSurfaceBrush}" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                                    </StackPanel>
                                </Border>
                                <Border Background="{DynamicResource SurfaceVariantBrush}" CornerRadius="10" Padding="10,8" Margin="2,0">
                                    <StackPanel HorizontalAlignment="Center">
                                        <TextBlock Text="Avg" FontSize="10" Foreground="{DynamicResource OnSurfaceVariantBrush}" HorizontalAlignment="Center"/>
                                        <TextBlock Text="{Binding HourlyTemperatures, Converter={StaticResource AvgTempConverter}}" FontSize="16" FontWeight="Bold" Foreground="{DynamicResource OnSurfaceBrush}" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                                    </StackPanel>
                                </Border>
                                <Border Background="{DynamicResource SurfaceVariantBrush}" CornerRadius="10" Padding="10,8" Margin="4,0,0,0">
                                    <StackPanel HorizontalAlignment="Center">
                                        <TextBlock Text="Max" FontSize="10" Foreground="{DynamicResource OnSurfaceVariantBrush}" HorizontalAlignment="Center"/>
                                        <TextBlock Text="{Binding HourlyTemperatures, Converter={StaticResource MaxTempConverter}}" FontSize="16" FontWeight="Bold" Foreground="{DynamicResource OnSurfaceBrush}" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                                    </StackPanel>
                                </Border>
                            </UniformGrid>
                        </StackPanel>
                    </Border>
                </Grid>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>